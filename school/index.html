<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0087)https://microservices.chaoxing.com/microService/enterSchool2/index?formId=39459&fid=497 -->
<html>
  <script type="text/javascript" src="chrome-extension://nhpjggchkhnlbgdfcbgpdpkifemomkpg/pageScripts/main.js"></script>

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <link rel="stylesheet" href="./css.css">
    <link rel="stylesheet" href="./css copy.css">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
    </script>
    <script type="text/javascript" src="sw.js"></script>
    <title>入校申请</title>
  </head>

  <body>
    <div class="myApprovalList">
      <ul id="content">

        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span class="fack_time1">2023-05-24 17:35:28</span></p>
          <p class="rxsj">入校时间：<span class="fack_time2">2023-05-24 17:34</span></p>
          <p class="lxsj">离校时间：<span class="fack_time3">2023-05-29 21:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="11863956" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-05-21 19:55:18</span></p>
          <p class="rxsj">入校时间：<span>2023-05-22 09:00</span></p>
          <p class="lxsj">离校时间：<span>2023-05-22 18:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="11782255" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-05-05 15:05:56</span></p>
          <p class="rxsj">入校时间：<span>2023-05-05 15:05</span></p>
          <p class="lxsj">离校时间：<span>2023-05-05 18:05</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="11334328" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-04-29 17:58:14</span></p>
          <p class="rxsj">入校时间：<span>2023-04-30 08:00</span></p>
          <p class="lxsj">离校时间：<span>2023-04-30 20:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="11227801" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-04-01 07:25:19</span></p>
          <p class="rxsj">入校时间：<span>2023-04-01 07:00</span></p>
          <p class="lxsj">离校时间：<span>2023-04-01 20:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="10522984" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-03-31 14:53:33</span></p>
          <p class="rxsj">入校时间：<span>2023-04-01 08:00</span></p>
          <p class="lxsj">离校时间：<span>2023-04-01 20:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="10509903" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-03-03 21:33:29</span></p>
          <p class="rxsj">入校时间：<span>2023-03-04 08:00</span></p>
          <p class="lxsj">离校时间：<span>2023-03-04 21:00</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="9862669" data-id="1">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-03-03 21:22:03</span></p>
          <p>申请状态：<span class="state yellowColor">已撤销</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="9862538" data-id="3">详情</a>
        </li>
        <li>
          <h3>卫晓强的访客申请</h3>
          <p>申请时间：<span>2023-02-28 17:59:49</span></p>
          <p class="rxsj">入校时间：<span>2023-03-01 12:00</span></p>
          <p class="lxsj">离校时间：<span>2023-03-01 23:59</span></p>
          <p>申请状态：<span class="state greenColor">已通过</span></p><a class="detailBtn" onclick="detailBtn(this)"
            id="9787525" data-id="1">详情</a>
        </li>
      </ul>
    </div>

    <!-- float -->
    <div class="floatBg" style="display: none;"></div>
    <div class="verifySuccess" style="display: none;">
      <div class="successInfoBg">
        <div class="successInfo">
          <h2 id="tipoc"><i class="icon" id="icon"></i>允许通行</h2>
          <div class="personInfo">
            <div class="headPic" id="field0" style="display: inline-block;"><i class="top"></i><span><img
                  src="eb73c2700c45d7e112cd4bf177796703.png"></span><i class="bottom"></i></div>
            <div class="infoList">
              <div class="item">
                <p>访客姓名：</p><span id="field1">卫晓强</span>
              </div>
              <div class="item" style="display: none;">
                <p>身份证号：</p><span id="field2"></span>
              </div>
              <div class="item">
                <p>访客单位：</p><span id="field3">学生</span>
              </div>
              <div class="item">
                <p>访问部门：</p><span id="field4">计算机与软件技术系</span>
              </div>
              <div class="item">
                <p>申请时间：</p><span id="field5">2023-05-24 17:35:28</span>
              </div>
              <div class="item" style="display: block;">
                <p>入校时间：</p><span id="field6">2023-05-24 17:34</span>
              </div>
              <div class="item" style="display: block;">
                <p>离校时间：</p><span id="field7">2023-05-29 21:00</span>
              </div>
            </div>
          </div>
          <!-- 无随行人员时不显示查看更多按钮，有随行人员时默认显示1个随行人员，有2个随行人员时显示查看更多按钮 -->

          <div class="personInfo" style="display: none" id="other1">
            <div class="headPic" id="sxfield0" style="display: none"><i class="top"></i><span><img
                  src="https://microservices.chaoxing.com/microService/enterSchool2/index?formId=39459&amp;fid=497"></span><i
                class="bottom"></i></div>
            <div class="infoList">
              <div class="item">
                <p>随行人员：</p><span id="sxfield1"></span>
              </div>
              <div class="item">
                <p>身份证号：</p><span id="sxfield2"></span>
              </div>
            </div>
          </div>
          <div class="moreList" id="other2"></div>
          <div id="countUser"></div>
        </div>
        <div class="bottombg"></div>
      </div>
    </div>

    <script>
        let time1, time2, time3;

     $(document).ready(function () {
        let date = new Date();
        /*
        三个时间段  
        第一个是现在时间 带时分秒  
        第二是现在时间不带秒 
        第三个是 5个小时后的时间不带秒  
        全部不够两位前面0填充
        */

        // 获取当前时间，带年月日时分秒
        let year = date.getFullYear().toString().padStart(4, '0');
        let month = (date.getMonth() + 1).toString().padStart(2, '0');
        let day = date.getDate().toString().padStart(2, '0');
        let hours = date.getHours().toString().padStart(2, '0');
        let minutes = date.getMinutes().toString().padStart(2, '0');
        let seconds = date.getSeconds().toString().padStart(2, '0');
        time1 = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        $('.fack_time1').text(time1);
       $('#field5').text(time1);

        // 获取当前时间，不带秒
        year = date.getFullYear().toString().padStart(4, '0');
        month = (date.getMonth() + 1).toString().padStart(2, '0');
        day = date.getDate().toString().padStart(2, '0');
        hours = date.getHours().toString().padStart(2, '0');
        minutes = date.getMinutes().toString().padStart(2, '0');
        time2 = `${year}-${month}-${day} ${hours}:${minutes}`;
        $('.fack_time2').text(time2); 
       $('#field6').text(time2); 

        // 获取5小时后的时间，不带秒
        date.setHours(date.getHours() + 5);
        year = date.getFullYear().toString().padStart(4, '0');
        month = (date.getMonth() + 1).toString().padStart(2, '0');
        day = date.getDate().toString().padStart(2, '0');
        hours = date.getHours().toString().padStart(2, '0');
        minutes = date.getMinutes().toString().padStart(2, '0');
        time3 = `${year}-${month}-${day} ${hours}:${minutes}`;
        $('.fack_time3').text(time3);
       $('#field7').text(time3); 

      });
      //弹窗 显示
      function detailBtn (obj) {
        $(".floatBg").show();
        $(".verifySuccess").show();
        $("html,body").css('overflow', 'hidden');
        var indexID = $(obj).attr("id");
        var aprvStatusId = $(obj).attr("data-id");
        //获取入校时间和离校时间
        var entryTime = $(obj).parent("li").find(".rxsj span").html();
        var leaveTime = $(obj).parent("li").find(".lxsj span").html();
        //将日期字符串转成时间戳，方便计算
        var rxsj = 0;
        var lxsj = 0;

        if (entryTime != null && entryTime != undefined && leaveTime != null && leaveTime != undefined) {
          entryTime = entryTime.replace(/-/g, "/");
          leaveTime = leaveTime.replace(/-/g, "/");

          rxsj = Date.parse(entryTime);
          lxsj = Date.parse(leaveTime);
        }
        var flag = false;
        if (aprvStatusId == 1) {
          //获取当前时间的时间戳
          var date = new Date();
          var time = date.getTime();

          if (time < rxsj) {
            $(".verifySuccess").addClass("verifyFail");
            $(".successInfo").addClass("noInfo");
            $("#tipoc").html("<i class='icon noEntry' id='icon'></i>禁止通行");
            $(".tips").text("未到入校时间，暂时不能进入。");
          } else if (time > lxsj) {
            $(".verifySuccess").addClass("verifyFail");
            $(".successInfo").addClass("noInfo");
            $("#tipoc").html("<i class='icon noEntry' id='icon'></i>禁止通行");
            $(".tips").text("入校时间已过期，如有需要，请重新申请！");
          } else {
            flag = true;
            $(".verifySuccess").removeClass("verifyFail");
            $(".successInfo").removeClass("noInfo");
            $("#tipoc").html("<i class='icon' id='icon'></i>允许通行");
            $(".tips").text("如遇发热等情况，无法进入校门的，请联系相关部门。");
          }
        } else {
          $(".verifySuccess").addClass("verifyFail");
          $(".successInfo").addClass("noInfo");
          $("#tipoc").html("<i class='icon noEntry' id='icon'></i>禁止通行");
          $(".tips").text("暂未查到您的入校审批通过记录，请联系相关人员进行审批。");
        }
        // getblcList(indexID, aprvStatusId, flag);
      }

      let bg = document.querySelector('.verifySuccess');
      bg.addEventListener('click', () => {
         $(".floatBg").hide();
         $(".verifySuccess").hide();
         $("html,body").css('overflow', 'auto');
      })
    </script>

  </body>

</html>